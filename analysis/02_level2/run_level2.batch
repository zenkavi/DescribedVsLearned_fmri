#!/bin/bash

#SBATCH -J level2-{SUBNUM}-reg_rt-{REG_RT}
#SBATCH -c 8

# Outputs ----------------------------------
#SBATCH -o /shared/.out/level2-{SUBNUM}-reg_rt-{REG_RT}.out
#SBATCH -e /shared/.err/level2-{SUBNUM}-reg_rt-{REG_RT}.err
# ------------------------------------------

export DATA_PATH=/shared/bids_nifti_wface/derivatives/nilearn/glm/level1
export OUT_PATH=/shared/bids_nifti_wface/derivatives/nilearn/glm/level2
export CODE_PATH=/shared/code/analysis/02_level2

aws s3 sync s3://described-vs-experienced/bids_nifti_wface/derivatives/nilearn/glm/level1/sub-{SUBNUM} $DATA_PATH/sub-{SUBNUM}

# cd $CODE_PATH
# ./level2.py -s {SUBNUM} --reg_rt {REG_RT}
docker run --rm -e DATA_PATH=/data -e OUT_PATH=/out \
-v $DATA_PATH:/data -v $OUT_PATH:/out -v $CODE_PATH:/code \
zenkavi/fsl:6.0.3 ./code/level2.py -s {SUBNUM} --reg_rt {REG_RT}

aws s3 sync $OUT_PATH/sub-{SUBNUM} s3://described-vs-experienced/bids_nifti_wface/derivatives/nilearn/glm/level2/sub-{SUBNUM}
sudo rm -rf $DATA_PATH/sub-{SUBNUM}
sudo rm -rf $OUT_PATH/sub-{SUBNUM}
