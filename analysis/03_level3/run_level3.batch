#!/bin/bash

#SBATCH -J level3-{MODELNUM}-{REGNAME}
#SBATCH -c 8

# Outputs ----------------------------------
#SBATCH -o /shared/.out/level3-{MODELNUM}-{REGNAME}.out
#SBATCH -e /shared/.err/level3-{MODELNUM}-{REGNAME}.err
# ------------------------------------------

export DATA_PATH=/shared/bids_nifti_wface/derivatives/nilearn/glm/level2
export OUT_PATH=/shared/bids_nifti_wface/derivatives/nilearn/glm/level3/{MODELNUM}
export CODE_PATH=/shared/code/analysis/03_level3
export BM_PATH=/shared/bids_nifti_wface/derivatives/fmriprep

aws s3 sync s3://described-vs-experienced/bids_nifti_wface/derivatives/nilearn/glm/level2/ $DATA_PATH/
aws s3 sync s3://described-vs-experienced/bids_nifti_wface/derivatives/fmriprep/ $BM_PATH/ --exclude "*" --include "*brain_mask.nii.gz"

cd $CODE_PATH
# ./level3.py -m {MODELNUM} -r {REGNAME}

docker run --rm -v $CODE_PATH:/code fsl:6.0.4 ./code/level3.py -m {MODELNUM} -r {REGNAME}
